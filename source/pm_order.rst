


物理机订单相关接口
====================

.. toctree::
   :maxdepth: 2
   :numbered:



概要
--------------------

1、获取当前项目我发出的订单，我接收的订单，我拒绝的订单，所有订单列表
2、用户可发起订单将项目进行转移
3、转移目标项目负责人确认或者拒绝订单


API规范
--------------------------

获取物理机API入口与API列表如下：


    * API入口: http://api.scloudm.com/
    * API列表:

+--------------------------+---------------------+------------+--------------------------+
|  资源                    |  操作               |  HTTP方法  |  URI路径                 |
+==========================+=====================+============+==========================+
|  /pm_order/<tenant_id>   |  获取项目订单信息   |  GET       | /pm_order/<tenant_id>    |
+--------------------------+---------------------+------------+--------------------------+
|  /pm_order/<tenant_id>   |  发起新的订单       |  POST      | /pm_order/<tenant_id>    |
+--------------------------+---------------------+------------+--------------------------+
|  /pm_order/<tenant_id>   |  接收或拒绝订单     |  PUT       | /pm_order/<tenant_id>    |
+--------------------------+---------------------+------------+--------------------------+

先认证并获取新令牌(已可用), 使用该令牌执行获取动作
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+------------+------------------------------------+---------------------+
|  HTTP方法  |  URI路径                           |  描述               |
+============+====================================+=====================+
|  GET       |  /mana_api/pm_order/<tenant_id>    |  获取项目订单信息   |
+------------+------------------------------------+---------------------+
|  POST      |  /mana_api/pm_order/<tenant_id>    |  发起新的订单       |
+------------+------------------------------------+---------------------+
|  PUT       |  /mana_api/pm_order/<tenant_id>    |  接收或拒绝订单     |
+------------+------------------------------------+---------------------+


获取订单请求参数

+-----------------------+----------+-------------------------------------------------------------------+
|  字段名               |  类型    |  描述                                                             |
+=======================+==========+===================================================================+
|  Sp-Agent             |  header  |  厂商类型如, 必须为scloudm                                        |
+-----------------------+----------+-------------------------------------------------------------------+
|  tenant_id            |  string  |  项目ID                                                           |
+-----------------------+----------+-------------------------------------------------------------------+
|  type                 |  string  |  0:未完成订单,1:已接受订单,2:拒绝的订单,3:我发起的订单,4:所有订单 |
+-----------------------+----------+-------------------------------------------------------------------+

获取订单列表请求样例

::


    curl  -i \
          -H 'X-Auth-Token: {token_id}' \
          -H 'Sp-Agent: scloudm' \
          -X GET 'http://api.scloudm.com/mana_api/pm_order/{tenant_id}?type=0'



返回参数

+-------------------+-------------+-------------------------------------------------------------------------+
|  字段名           |  类型       |  描述                                                                   |
+===================+=============+=========================================================================+
|  id               |  int        |  订单ID                                                                 |
+-------------------+-------------+-------------------------------------------------------------------------+
|  snids            |  string     |  订单所转移的物理机系统序列号列表，逗号间隔                             |
+-------------------+-------------+-------------------------------------------------------------------------+
|  resource_project |  string     |  发起订单的项目ID                                                       |
+-------------------+-------------+-------------------------------------------------------------------------+
|  dest_project     |  string     |  接受订单的项目ID                                                       |
+-------------------+-------------+-------------------------------------------------------------------------+
|  user             |  string     |  发起订单的用户的用户名                                                 |
+-------------------+-------------+-------------------------------------------------------------------------+
|  state            |  string     |  订单状态                                                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  warnning_times   |  string     |  报警时间                                                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  create_at        |  string     |  订单创建时间                                                           |
+-------------------+-------------+-------------------------------------------------------------------------+
|  update_at        |  string     |  订单更新时间                                                           |
+-------------------+-------------+-------------------------------------------------------------------------+

返回样例

::


         HTTP/1.0 200 OK
         Content-Type: application/json
         Content-Length: 523
         Server: Werkzeug/0.10.4 Python/2.7.5
         Date: Fri, 01 Apr 2016 04:38:24 GMT

         {
           "code": 200,
           "msg": "",
           "orders": [{
             "id": 6,
             "snids": "123re,34234,234s",
             "resource_project": "13805564478vfd",
             "dest_project": "sdf45dsf34",
             "user": "shiwenjun",
             "state": "finished",
             "warnning_times": "2016-03-29 23:00:00",
             "create_at": "2016-03-29 22:00:00",
             "update_at": "2016-03-29 23:50:00"
           }]
         }



发起订单请求参数

+-----------------------+----------+-------------------------------+
|  字段名               |  类型    |  描述                         |
+=======================+==========+===============================+
|  Sp-Agent             |  header  |  厂商类型如, 必须为scloudm    |
+-----------------------+----------+-------------------------------+
|  tenant_id            |  string  |  项目ID                       |
+-----------------------+----------+-------------------------------+
|  snids                |  string  |  需要迁移的snid列表,逗号间隔  |
+-----------------------+----------+-------------------------------+
|  dest_project         |  string  |  电话                         |
+-----------------------+----------+-------------------------------+
|  mailto               |  string  |  通知的邮件人列表，逗号间隔   |
+-----------------------+----------+-------------------------------+

发起订单请求样例

::


    curl  -i \
          -H 'X-Auth-Token: {token_id}' \
          -H 'Sp-Agent: scloudm' \
          -H 'Content-Type: application/json' \
          -X POST 'http://api.scloudm.com/mana_api/pm_order/{tenant_id}' \
          -d '{
            "snids": "123,456,789",
            "dest_project": "13dfg94440323dfc2",
            "mailto": "jiahua@ztgame.com,wenjun@ztgame.com"
          }'


发起订单返回样例

::


   HTTP/1.1 200 Bad Request
   {
     "msg": "add success",
     "code": 200,
   }





接受人反馈请求参数

+-----------------------+----------+-----------------------------------+
|  字段名               |  类型    |  描述                             |
+=======================+==========+===================================+
|  Sp-Agent             |  header  |  厂商类型如, 必须为scloudm        |
+-----------------------+----------+-----------------------------------+
|  order_ids            |  string  |  订单的id列表，逗号间隔           |
+-----------------------+----------+-----------------------------------+
|  accept               |  int     |  0:拒绝, 1:接受                   |
+-----------------------+----------+-----------------------------------+


接受人反馈请求样例

::


    curl  -i \
          -H 'X-Auth-Token: {token_id}' \
          -H 'Sp-Agent: scloudm' \
          -H 'Content-Type: application/json' \
          -X PUT 'http://api.scloudm.com/mana_api/pm_order/{tenant_id}'
          -d '{
            "order_ids": "1,2,3",
            "accept": 0
          }'



接受人反馈返回样例

::


   HTTP/1.1 200 Bad Request
   {
     "msg": "Order processing success",
     "code": 200,
   }




错误返回样例

::


   HTTP/1.1 400 Bad Request
   {
     "msg": "Malformed request URL: URL's project_id 'e58c78fe826f4f0b890767a3e078101' doesn't match Context's project_id 'e58c78fe826f4f0b890767a3e0781019'",
     "code": 400,
     "reason": "Unauthorized"
   }