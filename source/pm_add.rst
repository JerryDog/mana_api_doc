


新增物理机
====================

.. toctree::
   :maxdepth: 2
   :numbered:



概要
--------------------

管理员录入物理机，仅管理员有此权限访问该接口，仅支持单台物理机录入


API规范
--------------------------

获取物理机API入口与API列表如下：


    * API入口: http://api.scloudm.com/
    * API列表:

+------------------+-------------------------------+------------+--------------------------------+
|  资源            |  操作                         |  HTTP方法  |  URI路径                       |
+==================+===============================+============+================================+
|  pm_add          |  新增物理机                   |  POST      |  /mana_api/pm_add              |
+------------------+-------------------------------+------------+--------------------------------+

先认证并获取新令牌(已可用), 使用该令牌执行获取动作
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+------------+-------------------+-----------------+
|  HTTP方法  |  URI路径          |  描述           |
+============+===================+=================+
|  POST      |  /mana_api/pm_add | 新增物理机      |
+------------+-------------------+-----------------+

请求参数

+-------------------+-------------+-------------------------------------------------------------------------+
|  字段名           |  类型       |  描述                                                                   |
+===================+=============+=========================================================================+
|  Sp-Agent         |  header     |  厂商类型如, 必须为scloudm                                              |
+-------------------+-------------+-------------------------------------------------------------------------+
|  snid             |  string     |  系统序列号                                                             |
+-------------------+-------------+-------------------------------------------------------------------------+
|  asset_id         |  string     |  物理机资产编号                                                         |
+-------------------+-------------+-------------------------------------------------------------------------+
|  host_name        |  string     |  主机名                                                                 |
+-------------------+-------------+-------------------------------------------------------------------------+
|  os_type          |  string     |  物理机操作系统                                                         |
+-------------------+-------------+-------------------------------------------------------------------------+
|  ip               |  string     |  物理机ip，逗号分割                                                     |
+-------------------+-------------+-------------------------------------------------------------------------+
|  wan_ip           |  string     |  物理机外网ip，逗号分割                                                 |
+-------------------+-------------+-------------------------------------------------------------------------+
|  lan_ip           |  string     |  物理机内网ip，逗号分割                                                 |
+-------------------+-------------+-------------------------------------------------------------------------+
|  tenant_id        |  string     |  所属项目ID                                                             |
+-------------------+-------------+-------------------------------------------------------------------------+
|  region           |  string     |  所属区域                                                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  ilo_ip           |  string     |  ilo ip                                                                 |
+-------------------+-------------+-------------------------------------------------------------------------+
|  ilo_user         |  string     |  ilo_user                                                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  ilo_passwd       |  string     |  ilo_passwd                                                             |
+-------------------+-------------+-------------------------------------------------------------------------+
|  ilo_state        |  int        |  ilo 是否可用   0,1                                                     |
+-------------------+-------------+-------------------------------------------------------------------------+
|  remark           |  string     |  备注                                                                   |
+-------------------+-------------+-------------------------------------------------------------------------+
|  manufacturer     |  string     |  物理机厂商                                                             |
+-------------------+-------------+-------------------------------------------------------------------------+
|  cpu_num          |  int        |  cpu 核数                                                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  mem_size         |  int        |  物理机内存                                                             |
+-------------------+-------------+-------------------------------------------------------------------------+
|  disk_size        |  int        |  磁盘大小                                                               |
+-------------------+-------------+-------------------------------------------------------------------------+



请求样例

::


    curl  -i \
          -H 'X-Auth-Token: {token_id}' \
          -H 'Sp-Agent: scloudm' \
          -H 'Content-Type: application/json' \
          -X POST 'http://api.scloudm.com/mana_api/pm_add' \
          -d '{
             "snid": "21red23123",
             "asset_id": "213fdf342dfs",
             "host_name": "qiuqiu.com",
             "os_type": "windows",
             "ip": "192.168.0.2",
             "wan_ip": "222.73.193.33",
             "lan_ip": "192.168.0.2",
             "region": "zhenru",
             "ilo_ip": "172.30.28.3",
             "ilo_user": "root",
             "ilo_passwd": "ztgame",
             "ilo_state": 0,
             "remark": "hehe",
             "manufacturer": "qiuqiu",
             "cpu_num": 4,
             "mem_size": 8,
             "disk_size": 1000
          }'



返回参数


通用返回参数


返回样例

::


        HTTP/1.0 200 OK
        Content-Type: application/json
        Content-Length: 537
        Server: Werkzeug/0.10.4 Python/2.7.5
        Date: Thu, 28 Jan 2016 05:53:28 GMT

        {
          "code": 200,
          "msg": "add success"
        }


错误返回样例

::


   HTTP/1.1 400 Bad Request
   {
     "msg": "Malformed request URL: URL's project_id 'e58c78fe826f4f0b890767a3e078101' doesn't match Context's project_id 'e58c78fe826f4f0b890767a3e0781019'",
     "code": 400,
     "reason": "Unauthorized"
   }