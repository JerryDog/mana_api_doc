


物理机退库
====================

.. toctree::
   :maxdepth: 2
   :numbered:



概要
--------------------

用户可以将当前项目下物理机进行退库，即返还给管理员。退库后项目将看不到改物理机。
支持批量退库。


API规范
--------------------------

物理机退库API入口与API列表如下：


    * API入口: http://api.scloudm.com/
    * API列表:

+--------------------------+---------------------+------------+--------------------------+
|  资源                    |  操作               |  HTTP方法  |  URI路径                 |
+==========================+=====================+============+==========================+
|  /pm_refund/<tenant_id>  |  物理机退库         |  POST      | /pm_refund/<tenant_id>   |
+--------------------------+---------------------+------------+--------------------------+


先认证并获取新令牌(已可用), 使用该令牌执行获取动作
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+------------+------------------------------------+---------------------+
|  HTTP方法  |  URI路径                           |  描述               |
+============+====================================+=====================+
|  POST      |  /mana_api/pm_refund/<tenant_id>   |  物理机退库         |
+------------+------------------------------------+---------------------+


请求参数

+-----------------------+----------+-------------------------------+
|  字段名               |  类型    |  描述                         |
+=======================+==========+===============================+
|  Sp-Agent             |  header  |  厂商类型如, 必须为scloudm    |
+-----------------------+----------+-------------------------------+
|  tenant_id            |  string  |  项目ID                       |
+-----------------------+----------+-------------------------------+
|  snids                |  string  |  需要退库的snid列表,逗号间隔  |
+-----------------------+----------+-------------------------------+



请求样例

::


    curl  -i \
          -H 'X-Auth-Token: {token_id}' \
          -H 'Sp-Agent: scloudm' \
          -H 'Content-Type: application/json' \
          -X POST 'http://api.scloudm.com/mana_api/pm_refund/{tenant_id}' \
          -d '{
            "snids": "123,456,789"
          }'


返回样例

::


   HTTP/1.1 200 Bad Request
   {
     "msg": "",
     "code": 200,
     "detail": [
         {
            "code": 404,
            "msg": "pm server not found",
            "snid": "123",
            "sendmail": "do-nothing"
         },
         {
            "code": 200,
            "msg": "success",
            "snid": "456",
            "sendmail": "send mail success"
         },
         {
            "code": 200,
            "msg": "success",
            "snid": "789",
            "sendmail": "send mail success"
         }
      ]
   }




错误返回样例

::


   HTTP/1.1 400 Bad Request
   {
     "msg": "Malformed request URL: URL's project_id 'e58c78fe826f4f0b890767a3e078101' doesn't match Context's project_id 'e58c78fe826f4f0b890767a3e0781019'",
     "code": 400,
   }